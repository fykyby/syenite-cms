<fieldset
    class="gap-medium p-medium uk-rounded relative flex flex-col border shadow"
    x-data="{
        addItem() {
            if (!field.value) field.value = [];
            field.value.push({ fields: JSON.parse(JSON.stringify(field.fields)) });
        },

        deleteItem(index) {
            field.value.splice(index, 1);
        },

        moveItemUp(index) {
            if (index === 0) return;
            this.switchIndexes(field.value, index, index - 1);
        },

        moveItemDown(index) {
            if (index === field.value.length - 1) return;
            this.switchIndexes(field.value, index, index + 1);
        }
    }"
>
    <div class="right-medium absolute -top-[1.75rem] flex">
        <button
            class="uk-btn uk-btn-default uk-btn-icon uk-btn-xs block-movedown-btn border-border"
            type="button"
            @click="addItem()"
        >
            <uk-icon icon="plus"></uk-icon>
        </button>
    </div>

    <legend
        class="uk-btn-default uk-btn-xs uk-btn bg-card text-card-foreground border-border mr-auto place-self-start"
    >
        <span class="capitalize" x-text="field.key"></span>
    </legend>

    <template x-for="(item, k) in field.value">
        <fieldset
            class="gap-medium uk-rounded p-medium relative flex flex-col border"
            x-data="{ key: `${key}[${k}]` }"
        >
            <div class="right-medium absolute -top-[1.75rem] flex">
                <button
                    class="uk-btn uk-btn-default uk-btn-icon uk-btn-xs mr-smallest border-border"
                    type="button"
                    @click="moveItemUp(k)"
                >
                    <uk-icon icon="arrow-up"></uk-icon>
                </button>
                <button
                    class="uk-btn uk-btn-default uk-btn-icon uk-btn-xs mr-medium border-border"
                    type="button"
                    @click="moveItemDown(k)"
                >
                    <uk-icon icon="arrow-down"></uk-icon>
                </button>
                <button
                    class="uk-btn uk-btn-default uk-btn-icon uk-btn-xs border-border"
                    type="button"
                    @click="deleteItem(k)"
                >
                    <uk-icon icon="trash"></uk-icon>
                </button>
            </div>

            <legend
                class="uk-btn-default uk-btn-xs uk-btn bg-card text-card-foreground border-border mr-auto place-self-start"
            >
                <span x-text="k + 1"></span>
            </legend>

            <template
                x-for="(field, l) in item.fields"
                :key="`block-${j}-array-${k}-${l}-${field.key}`"
            >
                {% include 'page/_block_fieldset_field.twig' with {
                    depth: depth|default(0)
                } %}
            </template>
        </fieldset>
    </template>
</fieldset>
